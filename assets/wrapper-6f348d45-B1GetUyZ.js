import{g as pr,r as N}from"./index-BmnGgmfn.js";var Lt={},Fe={};Fe.byteLength=mr;Fe.toByteArray=gr;Fe.fromByteArray=wr;var j=[],M=[],dr=typeof Uint8Array<"u"?Uint8Array:Array,Pe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ie=0,_r=Pe.length;ie<_r;++ie)j[ie]=Pe[ie],M[Pe.charCodeAt(ie)]=ie;M[45]=62;M[95]=63;function At(n){var r=n.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=n.indexOf("=");i===-1&&(i=r);var o=i===r?0:4-i%4;return[i,o]}function mr(n){var r=At(n),i=r[0],o=r[1];return(i+o)*3/4-o}function yr(n,r,i){return(r+i)*3/4-i}function gr(n){var r,i=At(n),o=i[0],f=i[1],h=new dr(yr(n,o,f)),c=0,l=f>0?o-4:o,_;for(_=0;_<l;_+=4)r=M[n.charCodeAt(_)]<<18|M[n.charCodeAt(_+1)]<<12|M[n.charCodeAt(_+2)]<<6|M[n.charCodeAt(_+3)],h[c++]=r>>16&255,h[c++]=r>>8&255,h[c++]=r&255;return f===2&&(r=M[n.charCodeAt(_)]<<2|M[n.charCodeAt(_+1)]>>4,h[c++]=r&255),f===1&&(r=M[n.charCodeAt(_)]<<10|M[n.charCodeAt(_+1)]<<4|M[n.charCodeAt(_+2)]>>2,h[c++]=r>>8&255,h[c++]=r&255),h}function xr(n){return j[n>>18&63]+j[n>>12&63]+j[n>>6&63]+j[n&63]}function Er(n,r,i){for(var o,f=[],h=r;h<i;h+=3)o=(n[h]<<16&16711680)+(n[h+1]<<8&65280)+(n[h+2]&255),f.push(xr(o));return f.join("")}function wr(n){for(var r,i=n.length,o=i%3,f=[],h=16383,c=0,l=i-o;c<l;c+=h)f.push(Er(n,c,c+h>l?l:c+h));return o===1?(r=n[i-1],f.push(j[r>>2]+j[r<<4&63]+"==")):o===2&&(r=(n[i-2]<<8)+n[i-1],f.push(j[r>>10]+j[r>>4&63]+j[r<<2&63]+"=")),f.join("")}var Ke={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Ke.read=function(n,r,i,o,f){var h,c,l=f*8-o-1,_=(1<<l)-1,m=_>>1,g=-7,y=i?f-1:0,v=i?-1:1,w=n[r+y];for(y+=v,h=w&(1<<-g)-1,w>>=-g,g+=l;g>0;h=h*256+n[r+y],y+=v,g-=8);for(c=h&(1<<-g)-1,h>>=-g,g+=o;g>0;c=c*256+n[r+y],y+=v,g-=8);if(h===0)h=1-m;else{if(h===_)return c?NaN:(w?-1:1)*(1/0);c=c+Math.pow(2,o),h=h-m}return(w?-1:1)*c*Math.pow(2,h-o)};Ke.write=function(n,r,i,o,f,h){var c,l,_,m=h*8-f-1,g=(1<<m)-1,y=g>>1,v=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,w=o?0:h-1,b=o?1:-1,x=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(l=isNaN(r)?1:0,c=g):(c=Math.floor(Math.log(r)/Math.LN2),r*(_=Math.pow(2,-c))<1&&(c--,_*=2),c+y>=1?r+=v/_:r+=v*Math.pow(2,1-y),r*_>=2&&(c++,_/=2),c+y>=g?(l=0,c=g):c+y>=1?(l=(r*_-1)*Math.pow(2,f),c=c+y):(l=r*Math.pow(2,y-1)*Math.pow(2,f),c=0));f>=8;n[i+w]=l&255,w+=b,l/=256,f-=8);for(c=c<<f|l,m+=f;m>0;n[i+w]=c&255,w+=b,c/=256,m-=8);n[i+w-b]|=x*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){var r=Fe,i=Ke,o=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=l,n.SlowBuffer=te,n.INSPECT_MAX_BYTES=50;var f=2147483647;n.kMaxLength=f,l.TYPED_ARRAY_SUPPORT=h(),!l.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function h(){try{var s=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(s,e),s.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}});function c(s){if(s>f)throw new RangeError('The value "'+s+'" is invalid for option "size"');var e=new Uint8Array(s);return Object.setPrototypeOf(e,l.prototype),e}function l(s,e,t){if(typeof s=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return y(s)}return _(s,e,t)}l.poolSize=8192;function _(s,e,t){if(typeof s=="string")return v(s,e);if(ArrayBuffer.isView(s))return b(s);if(s==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s);if(W(s,ArrayBuffer)||s&&W(s.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(W(s,SharedArrayBuffer)||s&&W(s.buffer,SharedArrayBuffer)))return x(s,e,t);if(typeof s=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var a=s.valueOf&&s.valueOf();if(a!=null&&a!==s)return l.from(a,e,t);var u=O(s);if(u)return u;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof s[Symbol.toPrimitive]=="function")return l.from(s[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof s)}l.from=function(s,e,t){return _(s,e,t)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function m(s){if(typeof s!="number")throw new TypeError('"size" argument must be of type number');if(s<0)throw new RangeError('The value "'+s+'" is invalid for option "size"')}function g(s,e,t){return m(s),s<=0?c(s):e!==void 0?typeof t=="string"?c(s).fill(e,t):c(s).fill(e):c(s)}l.alloc=function(s,e,t){return g(s,e,t)};function y(s){return m(s),c(s<0?0:D(s)|0)}l.allocUnsafe=function(s){return y(s)},l.allocUnsafeSlow=function(s){return y(s)};function v(s,e){if((typeof e!="string"||e==="")&&(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var t=z(s,e)|0,a=c(t),u=a.write(s,e);return u!==t&&(a=a.slice(0,u)),a}function w(s){for(var e=s.length<0?0:D(s.length)|0,t=c(e),a=0;a<e;a+=1)t[a]=s[a]&255;return t}function b(s){if(W(s,Uint8Array)){var e=new Uint8Array(s);return x(e.buffer,e.byteOffset,e.byteLength)}return w(s)}function x(s,e,t){if(e<0||s.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(s.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');var a;return e===void 0&&t===void 0?a=new Uint8Array(s):t===void 0?a=new Uint8Array(s,e):a=new Uint8Array(s,e,t),Object.setPrototypeOf(a,l.prototype),a}function O(s){if(l.isBuffer(s)){var e=D(s.length)|0,t=c(e);return t.length===0||s.copy(t,0,0,e),t}if(s.length!==void 0)return typeof s.length!="number"||Me(s.length)?c(0):w(s);if(s.type==="Buffer"&&Array.isArray(s.data))return w(s.data)}function D(s){if(s>=f)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+f.toString(16)+" bytes");return s|0}function te(s){return+s!=s&&(s=0),l.alloc(+s)}l.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==l.prototype},l.compare=function(e,t){if(W(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),W(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var a=e.length,u=t.length,p=0,d=Math.min(a,u);p<d;++p)if(e[p]!==t[p]){a=e[p],u=t[p];break}return a<u?-1:u<a?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return l.alloc(0);var a;if(t===void 0)for(t=0,a=0;a<e.length;++a)t+=e[a].length;var u=l.allocUnsafe(t),p=0;for(a=0;a<e.length;++a){var d=e[a];if(W(d,Uint8Array))p+d.length>u.length?l.from(d).copy(u,p):Uint8Array.prototype.set.call(u,d,p);else if(l.isBuffer(d))d.copy(u,p);else throw new TypeError('"list" argument must be an Array of Buffers');p+=d.length}return u};function z(s,e){if(l.isBuffer(s))return s.length;if(ArrayBuffer.isView(s)||W(s,ArrayBuffer))return s.byteLength;if(typeof s!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof s);var t=s.length,a=arguments.length>2&&arguments[2]===!0;if(!a&&t===0)return 0;for(var u=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Re(s).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return it(s).length;default:if(u)return a?-1:Re(s).length;e=(""+e).toLowerCase(),u=!0}}l.byteLength=z;function V(s,e,t){var a=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(s||(s="utf8");;)switch(s){case"hex":return or(this,e,t);case"utf8":case"utf-8":return Je(this,e,t);case"ascii":return nr(this,e,t);case"latin1":case"binary":return sr(this,e,t);case"base64":return rr(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ar(this,e,t);default:if(a)throw new TypeError("Unknown encoding: "+s);s=(s+"").toLowerCase(),a=!0}}l.prototype._isBuffer=!0;function $(s,e,t){var a=s[e];s[e]=s[t],s[t]=a}l.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)$(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)$(this,t,t+3),$(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)$(this,t,t+7),$(this,t+1,t+6),$(this,t+2,t+5),$(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return e===0?"":arguments.length===0?Je(this,0,e):V.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:l.compare(this,e)===0},l.prototype.inspect=function(){var e="",t=n.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,a,u,p){if(W(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),a===void 0&&(a=e?e.length:0),u===void 0&&(u=0),p===void 0&&(p=this.length),t<0||a>e.length||u<0||p>this.length)throw new RangeError("out of range index");if(u>=p&&t>=a)return 0;if(u>=p)return-1;if(t>=a)return 1;if(t>>>=0,a>>>=0,u>>>=0,p>>>=0,this===e)return 0;for(var d=p-u,E=a-t,S=Math.min(d,E),k=this.slice(u,p),L=e.slice(t,a),T=0;T<S;++T)if(k[T]!==L[T]){d=k[T],E=L[T];break}return d<E?-1:E<d?1:0};function re(s,e,t,a,u){if(s.length===0)return-1;if(typeof t=="string"?(a=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,Me(t)&&(t=u?0:s.length-1),t<0&&(t=s.length+t),t>=s.length){if(u)return-1;t=s.length-1}else if(t<0)if(u)t=0;else return-1;if(typeof e=="string"&&(e=l.from(e,a)),l.isBuffer(e))return e.length===0?-1:oe(s,e,t,a,u);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?u?Uint8Array.prototype.indexOf.call(s,e,t):Uint8Array.prototype.lastIndexOf.call(s,e,t):oe(s,[e],t,a,u);throw new TypeError("val must be string, number or Buffer")}function oe(s,e,t,a,u){var p=1,d=s.length,E=e.length;if(a!==void 0&&(a=String(a).toLowerCase(),a==="ucs2"||a==="ucs-2"||a==="utf16le"||a==="utf-16le")){if(s.length<2||e.length<2)return-1;p=2,d/=2,E/=2,t/=2}function S(nt,st){return p===1?nt[st]:nt.readUInt16BE(st*p)}var k;if(u){var L=-1;for(k=t;k<d;k++)if(S(s,k)===S(e,L===-1?0:k-L)){if(L===-1&&(L=k),k-L+1===E)return L*p}else L!==-1&&(k-=k-L),L=-1}else for(t+E>d&&(t=d-E),k=t;k>=0;k--){for(var T=!0,ge=0;ge<E;ge++)if(S(s,k+ge)!==S(e,ge)){T=!1;break}if(T)return k}return-1}l.prototype.includes=function(e,t,a){return this.indexOf(e,t,a)!==-1},l.prototype.indexOf=function(e,t,a){return re(this,e,t,a,!0)},l.prototype.lastIndexOf=function(e,t,a){return re(this,e,t,a,!1)};function ae(s,e,t,a){t=Number(t)||0;var u=s.length-t;a?(a=Number(a),a>u&&(a=u)):a=u;var p=e.length;a>p/2&&(a=p/2);for(var d=0;d<a;++d){var E=parseInt(e.substr(d*2,2),16);if(Me(E))return d;s[t+d]=E}return d}function Ne(s,e,t,a){return ye(Re(e,s.length-t),s,t,a)}function Qt(s,e,t,a){return ye(lr(e),s,t,a)}function er(s,e,t,a){return ye(it(e),s,t,a)}function tr(s,e,t,a){return ye(ur(e,s.length-t),s,t,a)}l.prototype.write=function(e,t,a,u){if(t===void 0)u="utf8",a=this.length,t=0;else if(a===void 0&&typeof t=="string")u=t,a=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(a)?(a=a>>>0,u===void 0&&(u="utf8")):(u=a,a=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var p=this.length-t;if((a===void 0||a>p)&&(a=p),e.length>0&&(a<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");u||(u="utf8");for(var d=!1;;)switch(u){case"hex":return ae(this,e,t,a);case"utf8":case"utf-8":return Ne(this,e,t,a);case"ascii":case"latin1":case"binary":return Qt(this,e,t,a);case"base64":return er(this,e,t,a);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return tr(this,e,t,a);default:if(d)throw new TypeError("Unknown encoding: "+u);u=(""+u).toLowerCase(),d=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function rr(s,e,t){return e===0&&t===s.length?r.fromByteArray(s):r.fromByteArray(s.slice(e,t))}function Je(s,e,t){t=Math.min(s.length,t);for(var a=[],u=e;u<t;){var p=s[u],d=null,E=p>239?4:p>223?3:p>191?2:1;if(u+E<=t){var S,k,L,T;switch(E){case 1:p<128&&(d=p);break;case 2:S=s[u+1],(S&192)===128&&(T=(p&31)<<6|S&63,T>127&&(d=T));break;case 3:S=s[u+1],k=s[u+2],(S&192)===128&&(k&192)===128&&(T=(p&15)<<12|(S&63)<<6|k&63,T>2047&&(T<55296||T>57343)&&(d=T));break;case 4:S=s[u+1],k=s[u+2],L=s[u+3],(S&192)===128&&(k&192)===128&&(L&192)===128&&(T=(p&15)<<18|(S&63)<<12|(k&63)<<6|L&63,T>65535&&T<1114112&&(d=T))}}d===null?(d=65533,E=1):d>65535&&(d-=65536,a.push(d>>>10&1023|55296),d=56320|d&1023),a.push(d),u+=E}return ir(a)}var Qe=4096;function ir(s){var e=s.length;if(e<=Qe)return String.fromCharCode.apply(String,s);for(var t="",a=0;a<e;)t+=String.fromCharCode.apply(String,s.slice(a,a+=Qe));return t}function nr(s,e,t){var a="";t=Math.min(s.length,t);for(var u=e;u<t;++u)a+=String.fromCharCode(s[u]&127);return a}function sr(s,e,t){var a="";t=Math.min(s.length,t);for(var u=e;u<t;++u)a+=String.fromCharCode(s[u]);return a}function or(s,e,t){var a=s.length;(!e||e<0)&&(e=0),(!t||t<0||t>a)&&(t=a);for(var u="",p=e;p<t;++p)u+=cr[s[p]];return u}function ar(s,e,t){for(var a=s.slice(e,t),u="",p=0;p<a.length-1;p+=2)u+=String.fromCharCode(a[p]+a[p+1]*256);return u}l.prototype.slice=function(e,t){var a=this.length;e=~~e,t=t===void 0?a:~~t,e<0?(e+=a,e<0&&(e=0)):e>a&&(e=a),t<0?(t+=a,t<0&&(t=0)):t>a&&(t=a),t<e&&(t=e);var u=this.subarray(e,t);return Object.setPrototypeOf(u,l.prototype),u};function F(s,e,t){if(s%1!==0||s<0)throw new RangeError("offset is not uint");if(s+e>t)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,a){e=e>>>0,t=t>>>0,a||F(e,t,this.length);for(var u=this[e],p=1,d=0;++d<t&&(p*=256);)u+=this[e+d]*p;return u},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,a){e=e>>>0,t=t>>>0,a||F(e,t,this.length);for(var u=this[e+--t],p=1;t>0&&(p*=256);)u+=this[e+--t]*p;return u},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e=e>>>0,t||F(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||F(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||F(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||F(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||F(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,a){e=e>>>0,t=t>>>0,a||F(e,t,this.length);for(var u=this[e],p=1,d=0;++d<t&&(p*=256);)u+=this[e+d]*p;return p*=128,u>=p&&(u-=Math.pow(2,8*t)),u},l.prototype.readIntBE=function(e,t,a){e=e>>>0,t=t>>>0,a||F(e,t,this.length);for(var u=t,p=1,d=this[e+--u];u>0&&(p*=256);)d+=this[e+--u]*p;return p*=128,d>=p&&(d-=Math.pow(2,8*t)),d},l.prototype.readInt8=function(e,t){return e=e>>>0,t||F(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]},l.prototype.readInt16LE=function(e,t){e=e>>>0,t||F(e,2,this.length);var a=this[e]|this[e+1]<<8;return a&32768?a|4294901760:a},l.prototype.readInt16BE=function(e,t){e=e>>>0,t||F(e,2,this.length);var a=this[e+1]|this[e]<<8;return a&32768?a|4294901760:a},l.prototype.readInt32LE=function(e,t){return e=e>>>0,t||F(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e=e>>>0,t||F(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e=e>>>0,t||F(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e=e>>>0,t||F(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||F(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||F(e,8,this.length),i.read(this,e,!1,52,8)};function I(s,e,t,a,u,p){if(!l.isBuffer(s))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>u||e<p)throw new RangeError('"value" argument is out of bounds');if(t+a>s.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,a,u){if(e=+e,t=t>>>0,a=a>>>0,!u){var p=Math.pow(2,8*a)-1;I(this,e,t,a,p,0)}var d=1,E=0;for(this[t]=e&255;++E<a&&(d*=256);)this[t+E]=e/d&255;return t+a},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,a,u){if(e=+e,t=t>>>0,a=a>>>0,!u){var p=Math.pow(2,8*a)-1;I(this,e,t,a,p,0)}var d=a-1,E=1;for(this[t+d]=e&255;--d>=0&&(E*=256);)this[t+d]=e/E&255;return t+a},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,1,255,0),this[t]=e&255,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4},l.prototype.writeIntLE=function(e,t,a,u){if(e=+e,t=t>>>0,!u){var p=Math.pow(2,8*a-1);I(this,e,t,a,p-1,-p)}var d=0,E=1,S=0;for(this[t]=e&255;++d<a&&(E*=256);)e<0&&S===0&&this[t+d-1]!==0&&(S=1),this[t+d]=(e/E>>0)-S&255;return t+a},l.prototype.writeIntBE=function(e,t,a,u){if(e=+e,t=t>>>0,!u){var p=Math.pow(2,8*a-1);I(this,e,t,a,p-1,-p)}var d=a-1,E=1,S=0;for(this[t+d]=e&255;--d>=0&&(E*=256);)e<0&&S===0&&this[t+d+1]!==0&&(S=1),this[t+d]=(e/E>>0)-S&255;return t+a},l.prototype.writeInt8=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1},l.prototype.writeInt16LE=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2},l.prototype.writeInt32LE=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,a){return e=+e,t=t>>>0,a||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function et(s,e,t,a,u,p){if(t+a>s.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function tt(s,e,t,a,u){return e=+e,t=t>>>0,u||et(s,e,t,4),i.write(s,e,t,a,23,4),t+4}l.prototype.writeFloatLE=function(e,t,a){return tt(this,e,t,!0,a)},l.prototype.writeFloatBE=function(e,t,a){return tt(this,e,t,!1,a)};function rt(s,e,t,a,u){return e=+e,t=t>>>0,u||et(s,e,t,8),i.write(s,e,t,a,52,8),t+8}l.prototype.writeDoubleLE=function(e,t,a){return rt(this,e,t,!0,a)},l.prototype.writeDoubleBE=function(e,t,a){return rt(this,e,t,!1,a)},l.prototype.copy=function(e,t,a,u){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(a||(a=0),!u&&u!==0&&(u=this.length),t>=e.length&&(t=e.length),t||(t=0),u>0&&u<a&&(u=a),u===a||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(a<0||a>=this.length)throw new RangeError("Index out of range");if(u<0)throw new RangeError("sourceEnd out of bounds");u>this.length&&(u=this.length),e.length-t<u-a&&(u=e.length-t+a);var p=u-a;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,a,u):Uint8Array.prototype.set.call(e,this.subarray(a,u),t),p},l.prototype.fill=function(e,t,a,u){if(typeof e=="string"){if(typeof t=="string"?(u=t,t=0,a=this.length):typeof a=="string"&&(u=a,a=this.length),u!==void 0&&typeof u!="string")throw new TypeError("encoding must be a string");if(typeof u=="string"&&!l.isEncoding(u))throw new TypeError("Unknown encoding: "+u);if(e.length===1){var p=e.charCodeAt(0);(u==="utf8"&&p<128||u==="latin1")&&(e=p)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<a)throw new RangeError("Out of range index");if(a<=t)return this;t=t>>>0,a=a===void 0?this.length:a>>>0,e||(e=0);var d;if(typeof e=="number")for(d=t;d<a;++d)this[d]=e;else{var E=l.isBuffer(e)?e:l.from(e,u),S=E.length;if(S===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(d=0;d<a-t;++d)this[d+t]=E[d%S]}return this};var fr=/[^+/0-9A-Za-z-_]/g;function hr(s){if(s=s.split("=")[0],s=s.trim().replace(fr,""),s.length<2)return"";for(;s.length%4!==0;)s=s+"=";return s}function Re(s,e){e=e||1/0;for(var t,a=s.length,u=null,p=[],d=0;d<a;++d){if(t=s.charCodeAt(d),t>55295&&t<57344){if(!u){if(t>56319){(e-=3)>-1&&p.push(239,191,189);continue}else if(d+1===a){(e-=3)>-1&&p.push(239,191,189);continue}u=t;continue}if(t<56320){(e-=3)>-1&&p.push(239,191,189),u=t;continue}t=(u-55296<<10|t-56320)+65536}else u&&(e-=3)>-1&&p.push(239,191,189);if(u=null,t<128){if((e-=1)<0)break;p.push(t)}else if(t<2048){if((e-=2)<0)break;p.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;p.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;p.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return p}function lr(s){for(var e=[],t=0;t<s.length;++t)e.push(s.charCodeAt(t)&255);return e}function ur(s,e){for(var t,a,u,p=[],d=0;d<s.length&&!((e-=2)<0);++d)t=s.charCodeAt(d),a=t>>8,u=t%256,p.push(u),p.push(a);return p}function it(s){return r.toByteArray(hr(s))}function ye(s,e,t,a){for(var u=0;u<a&&!(u+t>=e.length||u>=s.length);++u)e[u+t]=s[u];return u}function W(s,e){return s instanceof e||s!=null&&s.constructor!=null&&s.constructor.name!=null&&s.constructor.name===e.name}function Me(s){return s!==s}var cr=function(){for(var s="0123456789abcdef",e=new Array(256),t=0;t<16;++t)for(var a=t*16,u=0;u<16;++u)e[a+u]=s[t]+s[u];return e}()})(Lt);const vr=pr(Lt);var It={};function _e(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Sr(n){if(n.__esModule)return n;var r=n.default;if(typeof r=="function"){var i=function o(){if(this instanceof o){var f=[null];f.push.apply(f,arguments);var h=Function.bind.apply(r,f);return new h}return r.apply(this,arguments)};i.prototype=r.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(n).forEach(function(o){var f=Object.getOwnPropertyDescriptor(n,o);Object.defineProperty(i,o,f.get?f:{enumerable:!0,get:function(){return n[o]}})}),i}const{Duplex:br}=N;function ot(n){n.emit("close")}function kr(){!this.destroyed&&this._writableState.finished&&this.destroy()}function Nt(n){this.removeListener("error",Nt),this.destroy(),this.listenerCount("error")===0&&this.emit("error",n)}function Tr(n,r){let i=!0;const o=new br({...r,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return n.on("message",function(h,c){const l=!c&&o._readableState.objectMode?h.toString():h;o.push(l)||n.pause()}),n.once("error",function(h){o.destroyed||(i=!1,o.destroy(h))}),n.once("close",function(){o.destroyed||o.push(null)}),o._destroy=function(f,h){if(n.readyState===n.CLOSED){h(f),process.nextTick(ot,o);return}let c=!1;n.once("error",function(_){c=!0,h(_)}),n.once("close",function(){c||h(f),process.nextTick(ot,o)}),i&&n.terminate()},o._final=function(f){if(n.readyState===n.CONNECTING){n.once("open",function(){o._final(f)});return}n._socket!==null&&(n._socket._writableState.finished?(f(),o._readableState.endEmitted&&o.destroy()):(n._socket.once("finish",function(){f()}),n.close()))},o._read=function(){n.isPaused&&n.resume()},o._write=function(f,h,c){if(n.readyState===n.CONNECTING){n.once("open",function(){o._write(f,h,c)});return}n.send(f,c)},o.on("end",kr),o.on("error",Nt),o}var Cr=Tr;const Ki=_e(Cr);var ke={exports:{}},Q={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}},Br,Fr;const{EMPTY_BUFFER:Ur}=Q,ze=Buffer[Symbol.species];function Or(n,r){if(n.length===0)return Ur;if(n.length===1)return n[0];const i=Buffer.allocUnsafe(r);let o=0;for(let f=0;f<n.length;f++){const h=n[f];i.set(h,o),o+=h.length}return o<r?new ze(i.buffer,i.byteOffset,o):i}function Rt(n,r,i,o,f){for(let h=0;h<f;h++)i[o+h]=n[h]^r[h&3]}function Mt(n,r){for(let i=0;i<n.length;i++)n[i]^=r[i&3]}function Lr(n){return n.length===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.length)}function qe(n){if(qe.readOnly=!0,Buffer.isBuffer(n))return n;let r;return n instanceof ArrayBuffer?r=new ze(n):ArrayBuffer.isView(n)?r=new ze(n.buffer,n.byteOffset,n.byteLength):(r=Buffer.from(n),qe.readOnly=!1),r}ke.exports={concat:Or,mask:Rt,toArrayBuffer:Lr,toBuffer:qe,unmask:Mt};if(!It.WS_NO_BUFFER_UTIL)try{const n=require("bufferutil");Fr=ke.exports.mask=function(r,i,o,f,h){h<48?Rt(r,i,o,f,h):n.mask(r,i,o,f,h)},Br=ke.exports.unmask=function(r,i){r.length<32?Mt(r,i):n.unmask(r,i)}}catch{}var Ue=ke.exports;const at=Symbol("kDone"),De=Symbol("kRun");let Ar=class{constructor(r){this[at]=()=>{this.pending--,this[De]()},this.concurrency=r||1/0,this.jobs=[],this.pending=0}add(r){this.jobs.push(r),this[De]()}[De](){if(this.pending!==this.concurrency&&this.jobs.length){const r=this.jobs.shift();this.pending++,r(this[at])}}};var Ir=Ar;const fe=N,ft=Ue,Nr=Ir,{kStatusCode:Pt}=Q,Rr=Buffer[Symbol.species],Mr=Buffer.from([0,0,255,255]),Te=Symbol("permessage-deflate"),H=Symbol("total-length"),pe=Symbol("callback"),q=Symbol("buffers"),Se=Symbol("error");let xe,Pr=class{constructor(r,i,o){if(this._maxPayload=o|0,this._options=r||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!i,this._deflate=null,this._inflate=null,this.params=null,!xe){const f=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;xe=new Nr(f)}}static get extensionName(){return"permessage-deflate"}offer(){const r={};return this._options.serverNoContextTakeover&&(r.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(r.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(r.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?r.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(r.client_max_window_bits=!0),r}accept(r){return r=this.normalizeParams(r),this.params=this._isServer?this.acceptAsServer(r):this.acceptAsClient(r),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const r=this._deflate[pe];this._deflate.close(),this._deflate=null,r&&r(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(r){const i=this._options,o=r.find(f=>!(i.serverNoContextTakeover===!1&&f.server_no_context_takeover||f.server_max_window_bits&&(i.serverMaxWindowBits===!1||typeof i.serverMaxWindowBits=="number"&&i.serverMaxWindowBits>f.server_max_window_bits)||typeof i.clientMaxWindowBits=="number"&&!f.client_max_window_bits));if(!o)throw new Error("None of the extension offers can be accepted");return i.serverNoContextTakeover&&(o.server_no_context_takeover=!0),i.clientNoContextTakeover&&(o.client_no_context_takeover=!0),typeof i.serverMaxWindowBits=="number"&&(o.server_max_window_bits=i.serverMaxWindowBits),typeof i.clientMaxWindowBits=="number"?o.client_max_window_bits=i.clientMaxWindowBits:(o.client_max_window_bits===!0||i.clientMaxWindowBits===!1)&&delete o.client_max_window_bits,o}acceptAsClient(r){const i=r[0];if(this._options.clientNoContextTakeover===!1&&i.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!i.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(i.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&i.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return i}normalizeParams(r){return r.forEach(i=>{Object.keys(i).forEach(o=>{let f=i[o];if(f.length>1)throw new Error(`Parameter "${o}" must have only a single value`);if(f=f[0],o==="client_max_window_bits"){if(f!==!0){const h=+f;if(!Number.isInteger(h)||h<8||h>15)throw new TypeError(`Invalid value for parameter "${o}": ${f}`);f=h}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${o}": ${f}`)}else if(o==="server_max_window_bits"){const h=+f;if(!Number.isInteger(h)||h<8||h>15)throw new TypeError(`Invalid value for parameter "${o}": ${f}`);f=h}else if(o==="client_no_context_takeover"||o==="server_no_context_takeover"){if(f!==!0)throw new TypeError(`Invalid value for parameter "${o}": ${f}`)}else throw new Error(`Unknown parameter "${o}"`);i[o]=f})}),r}decompress(r,i,o){xe.add(f=>{this._decompress(r,i,(h,c)=>{f(),o(h,c)})})}compress(r,i,o){xe.add(f=>{this._compress(r,i,(h,c)=>{f(),o(h,c)})})}_decompress(r,i,o){const f=this._isServer?"client":"server";if(!this._inflate){const h=`${f}_max_window_bits`,c=typeof this.params[h]!="number"?fe.Z_DEFAULT_WINDOWBITS:this.params[h];this._inflate=fe.createInflateRaw({...this._options.zlibInflateOptions,windowBits:c}),this._inflate[Te]=this,this._inflate[H]=0,this._inflate[q]=[],this._inflate.on("error",$r),this._inflate.on("data",Dt)}this._inflate[pe]=o,this._inflate.write(r),i&&this._inflate.write(Mr),this._inflate.flush(()=>{const h=this._inflate[Se];if(h){this._inflate.close(),this._inflate=null,o(h);return}const c=ft.concat(this._inflate[q],this._inflate[H]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[H]=0,this._inflate[q]=[],i&&this.params[`${f}_no_context_takeover`]&&this._inflate.reset()),o(null,c)})}_compress(r,i,o){const f=this._isServer?"server":"client";if(!this._deflate){const h=`${f}_max_window_bits`,c=typeof this.params[h]!="number"?fe.Z_DEFAULT_WINDOWBITS:this.params[h];this._deflate=fe.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:c}),this._deflate[H]=0,this._deflate[q]=[],this._deflate.on("data",Dr)}this._deflate[pe]=o,this._deflate.write(r),this._deflate.flush(fe.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let h=ft.concat(this._deflate[q],this._deflate[H]);i&&(h=new Rr(h.buffer,h.byteOffset,h.length-4)),this._deflate[pe]=null,this._deflate[H]=0,this._deflate[q]=[],i&&this.params[`${f}_no_context_takeover`]&&this._deflate.reset(),o(null,h)})}};var Oe=Pr;function Dr(n){this[q].push(n),this[H]+=n.length}function Dt(n){if(this[H]+=n.length,this[Te]._maxPayload<1||this[H]<=this[Te]._maxPayload){this[q].push(n);return}this[Se]=new RangeError("Max payload size exceeded"),this[Se].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[Se][Pt]=1009,this.removeListener("data",Dt),this.reset()}function $r(n){this[Te]._inflate=null,n[Pt]=1007,this[pe](n)}var Ce={exports:{}};const Wr={},Gr=Object.freeze(Object.defineProperty({__proto__:null,default:Wr},Symbol.toStringTag,{value:"Module"})),jr=Sr(Gr);var ht;const{isUtf8:lt}=vr,Vr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Hr(n){return n>=1e3&&n<=1014&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999}function Xe(n){const r=n.length;let i=0;for(;i<r;)if(!(n[i]&128))i++;else if((n[i]&224)===192){if(i+1===r||(n[i+1]&192)!==128||(n[i]&254)===192)return!1;i+=2}else if((n[i]&240)===224){if(i+2>=r||(n[i+1]&192)!==128||(n[i+2]&192)!==128||n[i]===224&&(n[i+1]&224)===128||n[i]===237&&(n[i+1]&224)===160)return!1;i+=3}else if((n[i]&248)===240){if(i+3>=r||(n[i+1]&192)!==128||(n[i+2]&192)!==128||(n[i+3]&192)!==128||n[i]===240&&(n[i+1]&240)===128||n[i]===244&&n[i+1]>143||n[i]>244)return!1;i+=4}else return!1;return!0}Ce.exports={isValidStatusCode:Hr,isValidUTF8:Xe,tokenChars:Vr};if(lt)ht=Ce.exports.isValidUTF8=function(n){return n.length<24?Xe(n):lt(n)};else if(!It.WS_NO_UTF_8_VALIDATE)try{const n=jr;ht=Ce.exports.isValidUTF8=function(r){return r.length<32?Xe(r):n(r)}}catch{}var Le=Ce.exports;const{Writable:Yr}=N,ut=Oe,{BINARY_TYPES:zr,EMPTY_BUFFER:ct,kStatusCode:qr,kWebSocket:Xr}=Q,{concat:$e,toArrayBuffer:Kr,unmask:Zr}=Ue,{isValidStatusCode:Jr,isValidUTF8:pt}=Le,Ee=Buffer[Symbol.species],he=0,dt=1,_t=2,mt=3,We=4,Qr=5;let ei=class extends Yr{constructor(r={}){super(),this._binaryType=r.binaryType||zr[0],this._extensions=r.extensions||{},this._isServer=!!r.isServer,this._maxPayload=r.maxPayload|0,this._skipUTF8Validation=!!r.skipUTF8Validation,this[Xr]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=he,this._loop=!1}_write(r,i,o){if(this._opcode===8&&this._state==he)return o();this._bufferedBytes+=r.length,this._buffers.push(r),this.startLoop(o)}consume(r){if(this._bufferedBytes-=r,r===this._buffers[0].length)return this._buffers.shift();if(r<this._buffers[0].length){const o=this._buffers[0];return this._buffers[0]=new Ee(o.buffer,o.byteOffset+r,o.length-r),new Ee(o.buffer,o.byteOffset,r)}const i=Buffer.allocUnsafe(r);do{const o=this._buffers[0],f=i.length-r;r>=o.length?i.set(this._buffers.shift(),f):(i.set(new Uint8Array(o.buffer,o.byteOffset,r),f),this._buffers[0]=new Ee(o.buffer,o.byteOffset+r,o.length-r)),r-=o.length}while(r>0);return i}startLoop(r){let i;this._loop=!0;do switch(this._state){case he:i=this.getInfo();break;case dt:i=this.getPayloadLength16();break;case _t:i=this.getPayloadLength64();break;case mt:this.getMask();break;case We:i=this.getData(r);break;default:this._loop=!1;return}while(this._loop);r(i)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}const r=this.consume(2);if(r[0]&48)return this._loop=!1,U(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const i=(r[0]&64)===64;if(i&&!this._extensions[ut.extensionName])return this._loop=!1,U(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=(r[0]&128)===128,this._opcode=r[0]&15,this._payloadLength=r[1]&127,this._opcode===0){if(i)return this._loop=!1,U(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,U(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,U(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=i}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,U(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(i)return this._loop=!1,U(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1)return this._loop=!1,U(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}else return this._loop=!1,U(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(r[1]&128)===128,this._isServer){if(!this._masked)return this._loop=!1,U(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,U(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(this._payloadLength===126)this._state=dt;else if(this._payloadLength===127)this._state=_t;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}const r=this.consume(8),i=r.readUInt32BE(0);return i>Math.pow(2,21)-1?(this._loop=!1,U(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=i*Math.pow(2,32)+r.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,U(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=mt:this._state=We}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=We}getData(r){let i=ct;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}i=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&Zr(i,this._mask)}if(this._opcode>7)return this.controlMessage(i);if(this._compressed){this._state=Qr,this.decompress(i,r);return}return i.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(i)),this.dataMessage()}decompress(r,i){this._extensions[ut.extensionName].decompress(r,this._fin,(f,h)=>{if(f)return i(f);if(h.length){if(this._messageLength+=h.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return i(U(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(h)}const c=this.dataMessage();if(c)return i(c);this.startLoop(i)})}dataMessage(){if(this._fin){const r=this._messageLength,i=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let o;this._binaryType==="nodebuffer"?o=$e(i,r):this._binaryType==="arraybuffer"?o=Kr($e(i,r)):o=i,this.emit("message",o,!0)}else{const o=$e(i,r);if(!this._skipUTF8Validation&&!pt(o))return this._loop=!1,U(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",o,!1)}}this._state=he}controlMessage(r){if(this._opcode===8)if(this._loop=!1,r.length===0)this.emit("conclude",1005,ct),this.end();else{const i=r.readUInt16BE(0);if(!Jr(i))return U(RangeError,`invalid status code ${i}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const o=new Ee(r.buffer,r.byteOffset+2,r.length-2);if(!this._skipUTF8Validation&&!pt(o))return U(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",i,o),this.end()}else this._opcode===9?this.emit("ping",r):this.emit("pong",r);this._state=he}};var $t=ei;function U(n,r,i,o,f){const h=new n(i?`Invalid WebSocket frame: ${r}`:r);return Error.captureStackTrace(h,U),h.code=f,h[qr]=o,h}const en=_e($t),{randomFillSync:ti}=N,yt=Oe,{EMPTY_BUFFER:ri}=Q,{isValidStatusCode:ii}=Le,{mask:gt,toBuffer:ne}=Ue,P=Symbol("kByteLength"),ni=Buffer.alloc(4);let si=class Z{constructor(r,i,o){this._extensions=i||{},o&&(this._generateMask=o,this._maskBuffer=Buffer.alloc(4)),this._socket=r,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(r,i){let o,f=!1,h=2,c=!1;i.mask&&(o=i.maskBuffer||ni,i.generateMask?i.generateMask(o):ti(o,0,4),c=(o[0]|o[1]|o[2]|o[3])===0,h=6);let l;typeof r=="string"?(!i.mask||c)&&i[P]!==void 0?l=i[P]:(r=Buffer.from(r),l=r.length):(l=r.length,f=i.mask&&i.readOnly&&!c);let _=l;l>=65536?(h+=8,_=127):l>125&&(h+=2,_=126);const m=Buffer.allocUnsafe(f?l+h:h);return m[0]=i.fin?i.opcode|128:i.opcode,i.rsv1&&(m[0]|=64),m[1]=_,_===126?m.writeUInt16BE(l,2):_===127&&(m[2]=m[3]=0,m.writeUIntBE(l,4,6)),i.mask?(m[1]|=128,m[h-4]=o[0],m[h-3]=o[1],m[h-2]=o[2],m[h-1]=o[3],c?[m,r]:f?(gt(r,o,m,h,l),[m]):(gt(r,o,r,0,l),[m,r])):[m,r]}close(r,i,o,f){let h;if(r===void 0)h=ri;else{if(typeof r!="number"||!ii(r))throw new TypeError("First argument must be a valid error code number");if(i===void 0||!i.length)h=Buffer.allocUnsafe(2),h.writeUInt16BE(r,0);else{const l=Buffer.byteLength(i);if(l>123)throw new RangeError("The message must not be greater than 123 bytes");h=Buffer.allocUnsafe(2+l),h.writeUInt16BE(r,0),typeof i=="string"?h.write(i,2):h.set(i,2)}}const c={[P]:h.length,fin:!0,generateMask:this._generateMask,mask:o,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,h,!1,c,f]):this.sendFrame(Z.frame(h,c),f)}ping(r,i,o){let f,h;if(typeof r=="string"?(f=Buffer.byteLength(r),h=!1):(r=ne(r),f=r.length,h=ne.readOnly),f>125)throw new RangeError("The data size must not be greater than 125 bytes");const c={[P]:f,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:9,readOnly:h,rsv1:!1};this._deflating?this.enqueue([this.dispatch,r,!1,c,o]):this.sendFrame(Z.frame(r,c),o)}pong(r,i,o){let f,h;if(typeof r=="string"?(f=Buffer.byteLength(r),h=!1):(r=ne(r),f=r.length,h=ne.readOnly),f>125)throw new RangeError("The data size must not be greater than 125 bytes");const c={[P]:f,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:10,readOnly:h,rsv1:!1};this._deflating?this.enqueue([this.dispatch,r,!1,c,o]):this.sendFrame(Z.frame(r,c),o)}send(r,i,o){const f=this._extensions[yt.extensionName];let h=i.binary?2:1,c=i.compress,l,_;if(typeof r=="string"?(l=Buffer.byteLength(r),_=!1):(r=ne(r),l=r.length,_=ne.readOnly),this._firstFragment?(this._firstFragment=!1,c&&f&&f.params[f._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(c=l>=f._threshold),this._compress=c):(c=!1,h=0),i.fin&&(this._firstFragment=!0),f){const m={[P]:l,fin:i.fin,generateMask:this._generateMask,mask:i.mask,maskBuffer:this._maskBuffer,opcode:h,readOnly:_,rsv1:c};this._deflating?this.enqueue([this.dispatch,r,this._compress,m,o]):this.dispatch(r,this._compress,m,o)}else this.sendFrame(Z.frame(r,{[P]:l,fin:i.fin,generateMask:this._generateMask,mask:i.mask,maskBuffer:this._maskBuffer,opcode:h,readOnly:_,rsv1:!1}),o)}dispatch(r,i,o,f){if(!i){this.sendFrame(Z.frame(r,o),f);return}const h=this._extensions[yt.extensionName];this._bufferedBytes+=o[P],this._deflating=!0,h.compress(r,o.fin,(c,l)=>{if(this._socket.destroyed){const _=new Error("The socket was closed while data was being compressed");typeof f=="function"&&f(_);for(let m=0;m<this._queue.length;m++){const g=this._queue[m],y=g[g.length-1];typeof y=="function"&&y(_)}return}this._bufferedBytes-=o[P],this._deflating=!1,o.readOnly=!1,this.sendFrame(Z.frame(l,o),f),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const r=this._queue.shift();this._bufferedBytes-=r[3][P],Reflect.apply(r[0],this,r.slice(1))}}enqueue(r){this._bufferedBytes+=r[3][P],this._queue.push(r)}sendFrame(r,i){r.length===2?(this._socket.cork(),this._socket.write(r[0]),this._socket.write(r[1],i),this._socket.uncork()):this._socket.write(r[0],i)}};var Wt=si;const tn=_e(Wt),{kForOnEventAttribute:le,kListener:Ge}=Q,xt=Symbol("kCode"),Et=Symbol("kData"),wt=Symbol("kError"),vt=Symbol("kMessage"),St=Symbol("kReason"),se=Symbol("kTarget"),bt=Symbol("kType"),kt=Symbol("kWasClean");class ee{constructor(r){this[se]=null,this[bt]=r}get target(){return this[se]}get type(){return this[bt]}}Object.defineProperty(ee.prototype,"target",{enumerable:!0});Object.defineProperty(ee.prototype,"type",{enumerable:!0});class me extends ee{constructor(r,i={}){super(r),this[xt]=i.code===void 0?0:i.code,this[St]=i.reason===void 0?"":i.reason,this[kt]=i.wasClean===void 0?!1:i.wasClean}get code(){return this[xt]}get reason(){return this[St]}get wasClean(){return this[kt]}}Object.defineProperty(me.prototype,"code",{enumerable:!0});Object.defineProperty(me.prototype,"reason",{enumerable:!0});Object.defineProperty(me.prototype,"wasClean",{enumerable:!0});class Ae extends ee{constructor(r,i={}){super(r),this[wt]=i.error===void 0?null:i.error,this[vt]=i.message===void 0?"":i.message}get error(){return this[wt]}get message(){return this[vt]}}Object.defineProperty(Ae.prototype,"error",{enumerable:!0});Object.defineProperty(Ae.prototype,"message",{enumerable:!0});class Ze extends ee{constructor(r,i={}){super(r),this[Et]=i.data===void 0?null:i.data}get data(){return this[Et]}}Object.defineProperty(Ze.prototype,"data",{enumerable:!0});const oi={addEventListener(n,r,i={}){for(const f of this.listeners(n))if(!i[le]&&f[Ge]===r&&!f[le])return;let o;if(n==="message")o=function(h,c){const l=new Ze("message",{data:c?h:h.toString()});l[se]=this,we(r,this,l)};else if(n==="close")o=function(h,c){const l=new me("close",{code:h,reason:c.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});l[se]=this,we(r,this,l)};else if(n==="error")o=function(h){const c=new Ae("error",{error:h,message:h.message});c[se]=this,we(r,this,c)};else if(n==="open")o=function(){const h=new ee("open");h[se]=this,we(r,this,h)};else return;o[le]=!!i[le],o[Ge]=r,i.once?this.once(n,o):this.on(n,o)},removeEventListener(n,r){for(const i of this.listeners(n))if(i[Ge]===r&&!i[le]){this.removeListener(n,i);break}}};var ai={CloseEvent:me,ErrorEvent:Ae,Event:ee,EventTarget:oi,MessageEvent:Ze};function we(n,r,i){typeof n=="object"&&n.handleEvent?n.handleEvent.call(n,i):n.call(r,i)}const{tokenChars:ue}=Le;function G(n,r,i){n[r]===void 0?n[r]=[i]:n[r].push(i)}function fi(n){const r=Object.create(null);let i=Object.create(null),o=!1,f=!1,h=!1,c,l,_=-1,m=-1,g=-1,y=0;for(;y<n.length;y++)if(m=n.charCodeAt(y),c===void 0)if(g===-1&&ue[m]===1)_===-1&&(_=y);else if(y!==0&&(m===32||m===9))g===-1&&_!==-1&&(g=y);else if(m===59||m===44){if(_===-1)throw new SyntaxError(`Unexpected character at index ${y}`);g===-1&&(g=y);const w=n.slice(_,g);m===44?(G(r,w,i),i=Object.create(null)):c=w,_=g=-1}else throw new SyntaxError(`Unexpected character at index ${y}`);else if(l===void 0)if(g===-1&&ue[m]===1)_===-1&&(_=y);else if(m===32||m===9)g===-1&&_!==-1&&(g=y);else if(m===59||m===44){if(_===-1)throw new SyntaxError(`Unexpected character at index ${y}`);g===-1&&(g=y),G(i,n.slice(_,g),!0),m===44&&(G(r,c,i),i=Object.create(null),c=void 0),_=g=-1}else if(m===61&&_!==-1&&g===-1)l=n.slice(_,y),_=g=-1;else throw new SyntaxError(`Unexpected character at index ${y}`);else if(f){if(ue[m]!==1)throw new SyntaxError(`Unexpected character at index ${y}`);_===-1?_=y:o||(o=!0),f=!1}else if(h)if(ue[m]===1)_===-1&&(_=y);else if(m===34&&_!==-1)h=!1,g=y;else if(m===92)f=!0;else throw new SyntaxError(`Unexpected character at index ${y}`);else if(m===34&&n.charCodeAt(y-1)===61)h=!0;else if(g===-1&&ue[m]===1)_===-1&&(_=y);else if(_!==-1&&(m===32||m===9))g===-1&&(g=y);else if(m===59||m===44){if(_===-1)throw new SyntaxError(`Unexpected character at index ${y}`);g===-1&&(g=y);let w=n.slice(_,g);o&&(w=w.replace(/\\/g,""),o=!1),G(i,l,w),m===44&&(G(r,c,i),i=Object.create(null),c=void 0),l=void 0,_=g=-1}else throw new SyntaxError(`Unexpected character at index ${y}`);if(_===-1||h||m===32||m===9)throw new SyntaxError("Unexpected end of input");g===-1&&(g=y);const v=n.slice(_,g);return c===void 0?G(r,v,i):(l===void 0?G(i,v,!0):o?G(i,l,v.replace(/\\/g,"")):G(i,l,v),G(r,c,i)),r}function hi(n){return Object.keys(n).map(r=>{let i=n[r];return Array.isArray(i)||(i=[i]),i.map(o=>[r].concat(Object.keys(o).map(f=>{let h=o[f];return Array.isArray(h)||(h=[h]),h.map(c=>c===!0?f:`${f}=${c}`).join("; ")})).join("; ")).join(", ")}).join(", ")}var Gt={format:hi,parse:fi};const li=N,ui=N,ci=N,jt=N,pi=N,{randomBytes:di,createHash:_i}=N,{URL:je}=N,X=Oe,mi=$t,yi=Wt,{BINARY_TYPES:Tt,EMPTY_BUFFER:ve,GUID:gi,kForOnEventAttribute:Ve,kListener:xi,kStatusCode:Ei,kWebSocket:A,NOOP:Vt}=Q,{EventTarget:{addEventListener:wi,removeEventListener:vi}}=ai,{format:Si,parse:bi}=Gt,{toBuffer:ki}=Ue,Ti=30*1e3,Ht=Symbol("kAborted"),He=[8,13],Y=["CONNECTING","OPEN","CLOSING","CLOSED"],Ci=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;let B=class C extends li{constructor(r,i,o){super(),this._binaryType=Tt[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=ve,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=C.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,r!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,i===void 0?i=[]:Array.isArray(i)||(typeof i=="object"&&i!==null?(o=i,i=[]):i=[i]),zt(this,r,i,o)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(r){Tt.includes(r)&&(this._binaryType=r,this._receiver&&(this._receiver._binaryType=r))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(r,i,o){const f=new mi({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:o.maxPayload,skipUTF8Validation:o.skipUTF8Validation});this._sender=new yi(r,this._extensions,o.generateMask),this._receiver=f,this._socket=r,f[A]=this,r[A]=this,f.on("conclude",Ui),f.on("drain",Oi),f.on("error",Li),f.on("message",Ai),f.on("ping",Ii),f.on("pong",Ni),r.setTimeout(0),r.setNoDelay(),i.length>0&&r.unshift(i),r.on("close",Xt),r.on("data",Ie),r.on("end",Kt),r.on("error",Zt),this._readyState=C.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=C.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[X.extensionName]&&this._extensions[X.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=C.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(r,i){if(this.readyState!==C.CLOSED){if(this.readyState===C.CONNECTING){R(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===C.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=C.CLOSING,this._sender.close(r,i,!this._isServer,o=>{o||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Ti)}}pause(){this.readyState===C.CONNECTING||this.readyState===C.CLOSED||(this._paused=!0,this._socket.pause())}ping(r,i,o){if(this.readyState===C.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"?(o=r,r=i=void 0):typeof i=="function"&&(o=i,i=void 0),typeof r=="number"&&(r=r.toString()),this.readyState!==C.OPEN){Ye(this,r,o);return}i===void 0&&(i=!this._isServer),this._sender.ping(r||ve,i,o)}pong(r,i,o){if(this.readyState===C.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof r=="function"?(o=r,r=i=void 0):typeof i=="function"&&(o=i,i=void 0),typeof r=="number"&&(r=r.toString()),this.readyState!==C.OPEN){Ye(this,r,o);return}i===void 0&&(i=!this._isServer),this._sender.pong(r||ve,i,o)}resume(){this.readyState===C.CONNECTING||this.readyState===C.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(r,i,o){if(this.readyState===C.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof i=="function"&&(o=i,i={}),typeof r=="number"&&(r=r.toString()),this.readyState!==C.OPEN){Ye(this,r,o);return}const f={binary:typeof r!="string",mask:!this._isServer,compress:!0,fin:!0,...i};this._extensions[X.extensionName]||(f.compress=!1),this._sender.send(r||ve,f,o)}terminate(){if(this.readyState!==C.CLOSED){if(this.readyState===C.CONNECTING){R(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=C.CLOSING,this._socket.destroy())}}};Object.defineProperty(B,"CONNECTING",{enumerable:!0,value:Y.indexOf("CONNECTING")});Object.defineProperty(B.prototype,"CONNECTING",{enumerable:!0,value:Y.indexOf("CONNECTING")});Object.defineProperty(B,"OPEN",{enumerable:!0,value:Y.indexOf("OPEN")});Object.defineProperty(B.prototype,"OPEN",{enumerable:!0,value:Y.indexOf("OPEN")});Object.defineProperty(B,"CLOSING",{enumerable:!0,value:Y.indexOf("CLOSING")});Object.defineProperty(B.prototype,"CLOSING",{enumerable:!0,value:Y.indexOf("CLOSING")});Object.defineProperty(B,"CLOSED",{enumerable:!0,value:Y.indexOf("CLOSED")});Object.defineProperty(B.prototype,"CLOSED",{enumerable:!0,value:Y.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(n=>{Object.defineProperty(B.prototype,n,{enumerable:!0})});["open","error","close","message"].forEach(n=>{Object.defineProperty(B.prototype,`on${n}`,{enumerable:!0,get(){for(const r of this.listeners(n))if(r[Ve])return r[xi];return null},set(r){for(const i of this.listeners(n))if(i[Ve]){this.removeListener(n,i);break}typeof r=="function"&&this.addEventListener(n,r,{[Ve]:!0})}})});B.prototype.addEventListener=wi;B.prototype.removeEventListener=vi;var Yt=B;function zt(n,r,i,o){const f={protocolVersion:He[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...o,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!He.includes(f.protocolVersion))throw new RangeError(`Unsupported protocol version: ${f.protocolVersion} (supported versions: ${He.join(", ")})`);let h;if(r instanceof je)h=r,n._url=r.href;else{try{h=new je(r)}catch{throw new SyntaxError(`Invalid URL: ${r}`)}n._url=r}const c=h.protocol==="wss:",l=h.protocol==="ws+unix:";let _;if(h.protocol!=="ws:"&&!c&&!l?_=`The URL's protocol must be one of "ws:", "wss:", or "ws+unix:"`:l&&!h.pathname?_="The URL's pathname is empty":h.hash&&(_="The URL contains a fragment identifier"),_){const x=new SyntaxError(_);if(n._redirects===0)throw x;be(n,x);return}const m=c?443:80,g=di(16).toString("base64"),y=c?ui.request:ci.request,v=new Set;let w;if(f.createConnection=c?Fi:Bi,f.defaultPort=f.defaultPort||m,f.port=h.port||m,f.host=h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,f.headers={...f.headers,"Sec-WebSocket-Version":f.protocolVersion,"Sec-WebSocket-Key":g,Connection:"Upgrade",Upgrade:"websocket"},f.path=h.pathname+h.search,f.timeout=f.handshakeTimeout,f.perMessageDeflate&&(w=new X(f.perMessageDeflate!==!0?f.perMessageDeflate:{},!1,f.maxPayload),f.headers["Sec-WebSocket-Extensions"]=Si({[X.extensionName]:w.offer()})),i.length){for(const x of i){if(typeof x!="string"||!Ci.test(x)||v.has(x))throw new SyntaxError("An invalid or duplicated subprotocol was specified");v.add(x)}f.headers["Sec-WebSocket-Protocol"]=i.join(",")}if(f.origin&&(f.protocolVersion<13?f.headers["Sec-WebSocket-Origin"]=f.origin:f.headers.Origin=f.origin),(h.username||h.password)&&(f.auth=`${h.username}:${h.password}`),l){const x=f.path.split(":");f.socketPath=x[0],f.path=x[1]}let b;if(f.followRedirects){if(n._redirects===0){n._originalIpc=l,n._originalSecure=c,n._originalHostOrSocketPath=l?f.socketPath:h.host;const x=o&&o.headers;if(o={...o,headers:{}},x)for(const[O,D]of Object.entries(x))o.headers[O.toLowerCase()]=D}else if(n.listenerCount("redirect")===0){const x=l?n._originalIpc?f.socketPath===n._originalHostOrSocketPath:!1:n._originalIpc?!1:h.host===n._originalHostOrSocketPath;(!x||n._originalSecure&&!c)&&(delete f.headers.authorization,delete f.headers.cookie,x||delete f.headers.host,f.auth=void 0)}f.auth&&!o.headers.authorization&&(o.headers.authorization="Basic "+Buffer.from(f.auth).toString("base64")),b=n._req=y(f),n._redirects&&n.emit("redirect",n.url,b)}else b=n._req=y(f);f.timeout&&b.on("timeout",()=>{R(n,b,"Opening handshake has timed out")}),b.on("error",x=>{b===null||b[Ht]||(b=n._req=null,be(n,x))}),b.on("response",x=>{const O=x.headers.location,D=x.statusCode;if(O&&f.followRedirects&&D>=300&&D<400){if(++n._redirects>f.maxRedirects){R(n,b,"Maximum redirects exceeded");return}b.abort();let te;try{te=new je(O,r)}catch{const V=new SyntaxError(`Invalid URL: ${O}`);be(n,V);return}zt(n,te,i,o)}else n.emit("unexpected-response",b,x)||R(n,b,`Unexpected server response: ${x.statusCode}`)}),b.on("upgrade",(x,O,D)=>{if(n.emit("upgrade",x),n.readyState!==B.CONNECTING)return;if(b=n._req=null,x.headers.upgrade.toLowerCase()!=="websocket"){R(n,O,"Invalid Upgrade header");return}const te=_i("sha1").update(g+gi).digest("base64");if(x.headers["sec-websocket-accept"]!==te){R(n,O,"Invalid Sec-WebSocket-Accept header");return}const z=x.headers["sec-websocket-protocol"];let V;if(z!==void 0?v.size?v.has(z)||(V="Server sent an invalid subprotocol"):V="Server sent a subprotocol but none was requested":v.size&&(V="Server sent no subprotocol"),V){R(n,O,V);return}z&&(n._protocol=z);const $=x.headers["sec-websocket-extensions"];if($!==void 0){if(!w){R(n,O,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let re;try{re=bi($)}catch{R(n,O,"Invalid Sec-WebSocket-Extensions header");return}const oe=Object.keys(re);if(oe.length!==1||oe[0]!==X.extensionName){R(n,O,"Server indicated an extension that was not requested");return}try{w.accept(re[X.extensionName])}catch{R(n,O,"Invalid Sec-WebSocket-Extensions header");return}n._extensions[X.extensionName]=w}n.setSocket(O,D,{generateMask:f.generateMask,maxPayload:f.maxPayload,skipUTF8Validation:f.skipUTF8Validation})}),f.finishRequest?f.finishRequest(b,n):b.end()}function be(n,r){n._readyState=B.CLOSING,n.emit("error",r),n.emitClose()}function Bi(n){return n.path=n.socketPath,jt.connect(n)}function Fi(n){return n.path=void 0,!n.servername&&n.servername!==""&&(n.servername=jt.isIP(n.host)?"":n.host),pi.connect(n)}function R(n,r,i){n._readyState=B.CLOSING;const o=new Error(i);Error.captureStackTrace(o,R),r.setHeader?(r[Ht]=!0,r.abort(),r.socket&&!r.socket.destroyed&&r.socket.destroy(),process.nextTick(be,n,o)):(r.destroy(o),r.once("error",n.emit.bind(n,"error")),r.once("close",n.emitClose.bind(n)))}function Ye(n,r,i){if(r){const o=ki(r).length;n._socket?n._sender._bufferedBytes+=o:n._bufferedAmount+=o}if(i){const o=new Error(`WebSocket is not open: readyState ${n.readyState} (${Y[n.readyState]})`);process.nextTick(i,o)}}function Ui(n,r){const i=this[A];i._closeFrameReceived=!0,i._closeMessage=r,i._closeCode=n,i._socket[A]!==void 0&&(i._socket.removeListener("data",Ie),process.nextTick(qt,i._socket),n===1005?i.close():i.close(n,r))}function Oi(){const n=this[A];n.isPaused||n._socket.resume()}function Li(n){const r=this[A];r._socket[A]!==void 0&&(r._socket.removeListener("data",Ie),process.nextTick(qt,r._socket),r.close(n[Ei])),r.emit("error",n)}function Ct(){this[A].emitClose()}function Ai(n,r){this[A].emit("message",n,r)}function Ii(n){const r=this[A];r.pong(n,!r._isServer,Vt),r.emit("ping",n)}function Ni(n){this[A].emit("pong",n)}function qt(n){n.resume()}function Xt(){const n=this[A];this.removeListener("close",Xt),this.removeListener("data",Ie),this.removeListener("end",Kt),n._readyState=B.CLOSING;let r;!this._readableState.endEmitted&&!n._closeFrameReceived&&!n._receiver._writableState.errorEmitted&&(r=n._socket.read())!==null&&n._receiver.write(r),n._receiver.end(),this[A]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",Ct),n._receiver.on("finish",Ct))}function Ie(n){this[A]._receiver.write(n)||this.pause()}function Kt(){const n=this[A];n._readyState=B.CLOSING,n._receiver.end(),this.end()}function Zt(){const n=this[A];this.removeListener("error",Zt),this.on("error",Vt),n&&(n._readyState=B.CLOSING,this.destroy())}const rn=_e(Yt),{tokenChars:Ri}=Le;function Mi(n){const r=new Set;let i=-1,o=-1,f=0;for(f;f<n.length;f++){const c=n.charCodeAt(f);if(o===-1&&Ri[c]===1)i===-1&&(i=f);else if(f!==0&&(c===32||c===9))o===-1&&i!==-1&&(o=f);else if(c===44){if(i===-1)throw new SyntaxError(`Unexpected character at index ${f}`);o===-1&&(o=f);const l=n.slice(i,o);if(r.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);r.add(l),i=o=-1}else throw new SyntaxError(`Unexpected character at index ${f}`)}if(i===-1||o!==-1)throw new SyntaxError("Unexpected end of input");const h=n.slice(i,f);if(r.has(h))throw new SyntaxError(`The "${h}" subprotocol is duplicated`);return r.add(h),r}var Pi={parse:Mi};const Di=N,Be=N,{createHash:$i}=N,Bt=Gt,K=Oe,Wi=Pi,Gi=Yt,{GUID:ji,kWebSocket:Vi}=Q,Hi=/^[+/0-9A-Za-z]{22}==$/,Ft=0,Ut=1,Jt=2;class Yi extends Di{constructor(r,i){if(super(),r={maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:Gi,...r},r.port==null&&!r.server&&!r.noServer||r.port!=null&&(r.server||r.noServer)||r.server&&r.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(r.port!=null?(this._server=Be.createServer((o,f)=>{const h=Be.STATUS_CODES[426];f.writeHead(426,{"Content-Length":h.length,"Content-Type":"text/plain"}),f.end(h)}),this._server.listen(r.port,r.host,r.backlog,i)):r.server&&(this._server=r.server),this._server){const o=this.emit.bind(this,"connection");this._removeListeners=qi(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(f,h,c)=>{this.handleUpgrade(f,h,c,o)}})}r.perMessageDeflate===!0&&(r.perMessageDeflate={}),r.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=r,this._state=Ft}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(r){if(this._state===Jt){r&&this.once("close",()=>{r(new Error("The server is not running"))}),process.nextTick(ce,this);return}if(r&&this.once("close",r),this._state!==Ut)if(this._state=Ut,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(ce,this):process.nextTick(ce,this);else{const i=this._server;this._removeListeners(),this._removeListeners=this._server=null,i.close(()=>{ce(this)})}}shouldHandle(r){if(this.options.path){const i=r.url.indexOf("?");if((i!==-1?r.url.slice(0,i):r.url)!==this.options.path)return!1}return!0}handleUpgrade(r,i,o,f){i.on("error",Ot);const h=r.headers["sec-websocket-key"],c=+r.headers["sec-websocket-version"];if(r.method!=="GET"){J(this,r,i,405,"Invalid HTTP method");return}if(r.headers.upgrade.toLowerCase()!=="websocket"){J(this,r,i,400,"Invalid Upgrade header");return}if(!h||!Hi.test(h)){J(this,r,i,400,"Missing or invalid Sec-WebSocket-Key header");return}if(c!==8&&c!==13){J(this,r,i,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(r)){de(i,400);return}const l=r.headers["sec-websocket-protocol"];let _=new Set;if(l!==void 0)try{_=Wi.parse(l)}catch{J(this,r,i,400,"Invalid Sec-WebSocket-Protocol header");return}const m=r.headers["sec-websocket-extensions"],g={};if(this.options.perMessageDeflate&&m!==void 0){const y=new K(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const v=Bt.parse(m);v[K.extensionName]&&(y.accept(v[K.extensionName]),g[K.extensionName]=y)}catch{J(this,r,i,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){const y={origin:r.headers[`${c===8?"sec-websocket-origin":"origin"}`],secure:!!(r.socket.authorized||r.socket.encrypted),req:r};if(this.options.verifyClient.length===2){this.options.verifyClient(y,(v,w,b,x)=>{if(!v)return de(i,w||401,b,x);this.completeUpgrade(g,h,_,r,i,o,f)});return}if(!this.options.verifyClient(y))return de(i,401)}this.completeUpgrade(g,h,_,r,i,o,f)}completeUpgrade(r,i,o,f,h,c,l){if(!h.readable||!h.writable)return h.destroy();if(h[Vi])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>Ft)return de(h,503);const m=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${$i("sha1").update(i+ji).digest("base64")}`],g=new this.options.WebSocket(null);if(o.size){const y=this.options.handleProtocols?this.options.handleProtocols(o,f):o.values().next().value;y&&(m.push(`Sec-WebSocket-Protocol: ${y}`),g._protocol=y)}if(r[K.extensionName]){const y=r[K.extensionName].params,v=Bt.format({[K.extensionName]:[y]});m.push(`Sec-WebSocket-Extensions: ${v}`),g._extensions=r}this.emit("headers",m,f),h.write(m.concat(`\r
`).join(`\r
`)),h.removeListener("error",Ot),g.setSocket(h,c,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(g),g.on("close",()=>{this.clients.delete(g),this._shouldEmitClose&&!this.clients.size&&process.nextTick(ce,this)})),l(g,f)}}var zi=Yi;function qi(n,r){for(const i of Object.keys(r))n.on(i,r[i]);return function(){for(const o of Object.keys(r))n.removeListener(o,r[o])}}function ce(n){n._state=Jt,n.emit("close")}function Ot(){this.destroy()}function de(n,r,i,o){i=i||Be.STATUS_CODES[r],o={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(i),...o},n.once("finish",n.destroy),n.end(`HTTP/1.1 ${r} ${Be.STATUS_CODES[r]}\r
`+Object.keys(o).map(f=>`${f}: ${o[f]}`).join(`\r
`)+`\r
\r
`+i)}function J(n,r,i,o,f){if(n.listenerCount("wsClientError")){const h=new Error(f);Error.captureStackTrace(h,J),n.emit("wsClientError",h,i,r)}else de(i,o,f)}const nn=_e(zi);export{en as Receiver,tn as Sender,rn as WebSocket,nn as WebSocketServer,Ki as createWebSocketStream,rn as default};
